# API Эндпоинты (простое описание)

## Базовый URL
```
http://localhost/api/
```

---

## Авторизация

### POST /api/auth/register.php
Регистрация нового пользователя

**Тело запроса:**
```json
{
  "email": "user@example.com",
  "password": "password123",
  "name": "Иван Иванов"
}
```

**Ответ:**
```json
{
  "success": true,
  "data": {
    "user": {
      "id": 1,
      "email": "user@example.com",
      "name": "Иван Иванов"
    }
  }
}
```

### POST /api/auth/login.php
Авторизация

**Тело запроса:**
```json
{
  "email": "user@example.com",
  "password": "password123"
}
```

### POST /api/auth/logout.php
Выход из системы

### GET /api/auth/user.php
Получить информацию о текущем пользователе (требуется авторизация)

---

## Катки

### GET /api/rinks.php
Получить список всех катков

**Параметры:**
- `district` - фильтр по району
- `limit` - лимит результатов (по умолчанию 100)
- `offset` - смещение для пагинации

### GET /api/rinks.php?id={id}
Получить один каток по ID

### GET /api/rinks.php?search={query}
Поиск катков по названию (живой поиск)

---

## Отзывы

### GET /api/reviews.php?rink_id={id}
Получить отзывы катка (отсортированы по рейтингу голосования)

### POST /api/reviews.php
Создать отзыв (требуется авторизация)

**Тело запроса:**
```json
{
  "visit_id": 1,
  "text": "Отличный каток! Лед хороший, народу немного.",
  "rating": 5,
  "ice_condition": 5,
  "crowd_level": 3,
  "photo_path": "/uploads/review_1.jpg"
}
```

---

## Отметки присутствия

### GET /api/checkins.php?rink_id={id}
Получить отметки катка за последние 24 часа

**Ответ:**
```json
{
  "success": true,
  "data": {
    "checkins": [...],
    "current_count": 15
  }
}
```

### POST /api/checkins.php
Создать отметку присутствия (требуется авторизация)

**Тело запроса:**
```json
{
  "rink_id": 5,
  "latitude": 55.7558,
  "longitude": 37.6173
}
```

**Проверки:**
- Пользователь должен быть в радиусе 1 км от катка
- Не более одной отметки в час

---

## Голосование

### POST /api/votes.php
Проголосовать за отзыв (требуется авторизация)

**Тело запроса:**
```json
{
  "review_id": 10,
  "vote_type": "up"
}
```

**vote_type:** `"up"` или `"down"`

**Логика:**
- Если уже голосовал так же - голос отменяется
- Если голосовал по-другому - голос меняется

### DELETE /api/votes.php?review_id={id}
Отменить голос (требуется авторизация)

---

## Мероприятия

### GET /api/events.php?rink_id={id}
Получить мероприятия катка

### GET /api/events.php?id={id}
Получить одно мероприятие с участниками

### POST /api/events.php
Создать мероприятие (требуется авторизация + 5+ посещений катка)

**Тело запроса:**
```json
{
  "rink_id": 5,
  "title": "Догонялки",
  "description": "Играем в догонялки, все желающие!",
  "event_date": "2025-01-20",
  "event_time": "18:00",
  "max_participants": 20
}
```

### POST /api/events/join.php
Присоединиться к мероприятию (требуется авторизация + хотя бы одно посещение катка)

**Тело запроса:**
```json
{
  "event_id": 10
}
```

---

## Статистика

### GET /api/stats.php?rink_id={id}
Получить общую статистику катка

### GET /api/stats.php?rink_id={id}&type=time
Статистика по времени суток (для гистограммы)

### GET /api/stats.php?rink_id={id}&type=day
Статистика по дням недели

### GET /api/stats.php?rink_id={id}&type=indicators
Статистические показатели (среднее, медиана, мода)

### GET /api/stats.php?rink_id={id}&type=histogram
Гистограмма распределения загруженности

### GET /api/stats.php?heatmap=true
Данные для тепловой карты популярности всех катков

---

## Формат ответов

### Успешный ответ:
```json
{
  "success": true,
  "data": {...},
  "message": "Опциональное сообщение"
}
```

### Ошибка:
```json
{
  "success": false,
  "error": "Сообщение об ошибке"
}
```

---

## Коды HTTP

- `200` - Успешно
- `201` - Создано
- `400` - Ошибка запроса
- `401` - Требуется авторизация
- `403` - Доступ запрещен
- `404` - Не найдено
- `405` - Метод не поддерживается
- `422` - Ошибка валидации
- `500` - Ошибка сервера
